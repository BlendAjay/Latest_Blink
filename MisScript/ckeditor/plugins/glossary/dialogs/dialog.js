CKEDITOR.dialog.add("glossaryDialog",function(c){return{title:"Глоссарий",minWidth:400,minHeight:200,contents:[{id:"tab-id",label:"Добавить новый термин",requiredContent:"glossary[id]",elements:[{type:"text",id:"glossary",label:"Поиск термина",validate:CKEDITOR.dialog.validate.notEmpty("Термин не может быть пустым"),setup:function(b){this.setValue(b.getText())},commit:function(b){b.setText(this.getValue())}},{type:"select",id:"title",label:"Выберите термин",items:[["-","-"]],setup:function(b){this.setValue(b.getAttribute("title"))},
commit:function(b){var a=this.getInputElement().$;b.setAttribute("term",a.options[a.selectedIndex].text);b.setAttribute("title",this.getValue())}}]}],onShow:function(){this.setValueOf("tab-id","glossary",c.getSelection().getSelectedText().toString());var b="",a={title:c.getSelection().getSelectedText().toString()};$.getJSON("/api/terms/",a,function(a){for(var c=0;c<a.length;c++)b+='\x3coption value\x3d"'+a[c].definition+'"\x3e'+a[c].title+"\x3c/option\x3e";a="#"+CKEDITOR.dialog.getCurrent().getContentElement("tab-id",
"title").getInputElement().$.id;$(a).html(b)});(a=c.getSelection().getStartElement())&&(a=a.getAscendant("glossary",!0));a&&"glossary"==a.getName()?this.insertMode=!1:(a=c.document.createElement("glossary"),this.insertMode=!0);this.element=a;this.insertMode||this.setupContent(this.element)},onOk:function(){var b=this.element;this.commitContent(b);this.insertMode&&c.insertElement(b)}}});